<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>有声小说App - 沉浸漫改版</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #ff3b30;
            --bg-body: #f5f5f5;
            --card-bg: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background-color: #e0e0e0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 手机容器 */
        #app-shell {
            width: 100%;
            max-width: 414px; /* iPhone Pro Max 宽度 */
            height: 100%;
            max-height: 896px;
            background-color: var(--bg-body);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(0,0,0,0.2);
            border-radius: 0; 
        }
        
        /* 在桌面端显示圆角模拟手机 */
        @media (min-width: 450px) {
            #app-shell {
                height: 90vh;
                border-radius: 40px;
                border: 8px solid #333;
            }
        }

        /* --- 首页部分 --- */
        .home-container { flex: 1; overflow-y: auto; padding-bottom: 50px; }
        
        /* 顶部搜索区 */
        .header { padding: 8px 16px 0; background: #fff; position: sticky; top: 0; z-index: 10; }
        .search-bar { background: #f5f5f5; height: 32px; border-radius: 16px; display: flex; align-items: center; padding: 0 12px; color: #999; font-size: 13px; margin-bottom: 6px; }
        
        /* 标签导航栏 */
        .nav-tabs { display: flex; gap: 0; padding: 0 16px 6px; background: #fff; overflow-x: auto; scrollbar-width: none; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-tab { flex-shrink: 0; padding: 6px 12px; font-size: 15px; color: #333; position: relative; white-space: nowrap; }
        .nav-tab.active { color: #333; font-weight: bold; }
        .nav-tab.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 20px; height: 3px; background: var(--primary); border-radius: 2px; }
        .nav-badge { display: inline-block; width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin-left: 4px; vertical-align: top; }
        
        /* 本周收听统计区域 */
        .ai-guide { padding: 8px 16px 6px; background: #fff; display: flex; justify-content: space-between; align-items: center; }
        .ai-guide-text { font-size: 13px; color: #333; font-weight: 500; }
        .vip-promotion { font-size: 11px; color: var(--primary); background: rgba(255,59,48,0.1); padding: 4px 8px; border-radius: 12px; }
        
        /* 横幅区域 */
        .banner-section { padding: 0 16px 6px; background: #fff; }
        .banner-title { font-size: 14px; color: #333; margin-bottom: 6px; }
        .banner-title .vip-tag { font-size: 10px; color: var(--primary); background: rgba(255,59,48,0.1); padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
        
        /* 横向滑动卡片 - 3:4比例 */
        .horizontal-cards { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding-bottom: 6px; }
        .horizontal-cards::-webkit-scrollbar { display: none; }
        .h-card { flex-shrink: 0; width: 100px; height: 133px; border-radius: 8px; overflow: hidden; position: relative; background-size: cover; background-position: center; cursor: pointer; }
        .h-card-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 8px; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.3), transparent); color: #fff; }
        .h-card-title { font-size: 10px; font-weight: bold; margin-bottom: 4px; line-height: 1.3; }
        .h-card-subtitle { font-size: 9px; opacity: 0.9; }
        .h-card-btn { background: var(--primary); color: #fff; border: none; padding: 4px 8px; border-radius: 8px; font-size: 9px; cursor: pointer; white-space: nowrap; }
        
        /* 推荐区域 */
        .recommend-section { padding: 8px 16px; }
        .section-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 6px; display: flex; align-items: center; justify-content: space-between; }
        .section-more { font-size: 12px; color: #999; }
        
        /* 列表卡片容器 */
        #list-cards { margin-bottom: 8px; }
        
        /* 双列卡片布局 */
        .feed-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-card { background: #fff; border-radius: 12px; overflow: hidden; cursor: pointer; display: flex; flex-direction: column; }
        .grid-card:active { opacity: 0.8; }
        .grid-card-cover { width: 100%; aspect-ratio: 3/4; background-size: cover; background-position: center; position: relative; }
        .card-badge { display: none; /* 彻底隐藏角标 */ }
        .grid-card-info { padding: 8px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .grid-card-title { font-size: 14px; font-weight: 500; color: #333; line-height: 1.4; }
        .grid-card-description {
            font-size: 12px;
            color: #888;
            line-height: 1.5;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            margin-bottom: 6px; /* 为标签留出空间 */
        }
        .grid-card-meta { display: none; /* 隐藏旧的 meta 信息 */ }
        .grid-card-tags { 
            display: flex; /* 重新显示标签行 */
            gap: 4px;
            flex-wrap: nowrap;
            overflow: hidden;
        }
        .grid-tag {
            font-size: 10px;
            background: #fff9e6; /* 浅黄色背景 */
            padding: 2px 6px;
            border-radius: 4px;
            color: #d4a017; /* 深黄色文字 */
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        /* 特殊样式：标签和标题在一行 */
        .grid-card-inline-layout {
            font-size: 12px;
            color: #888;
            line-height: 1.5;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .grid-card-inline-layout .grid-tag {
            display: inline;
            background: #fff9e6;
            padding: 2px 6px;
            border-radius: 4px;
            color: #d4a017;
            white-space: nowrap;
            margin-right: 4px;
        }
        .grid-card-inline-layout .inline-title {
            display: inline;
            font-size: 12px;
            color: #888;
            font-weight: 400;
            line-height: 1.5;
        }
        
        /* 大型横幅广告 */
        .large-banner { margin-top: 16px; display: flex; gap: 10px; }
        .large-banner-item { flex: 1; height: 180px; border-radius: 12px; background-size: cover; background-position: center; cursor: pointer; }
        
        /* 列表卡片（单列） */
        .list-card { display: flex; gap: 8px; background: #fff; padding: 8px; margin-bottom: 6px; cursor: pointer; border-radius: 8px; }
        .list-card-cover { width: 60px; height: 60px; border-radius: 6px; background-size: cover; background-position: center; flex-shrink: 0; }
        .list-card-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .list-card-title { font-size: 13px; font-weight: 500; color: #333; margin-bottom: 2px; }
        .list-card-desc { font-size: 11px; color: #999; line-height: 1.3; }
        .list-card-badge { font-size: 9px; color: var(--primary); border: 1px solid var(--primary); padding: 2px 6px; border-radius: 4px; align-self: flex-start; }

        /* --- 沉浸式播放器 (Immersive Player) --- */
        .immersive-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            z-index: 100;
            transform: translateY(100%); /* 默认隐藏 */
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex;
            flex-direction: column;
            color: #fff;
        }
        .immersive-player.active { transform: translateY(0); }

        /* 1. 顶部：AI漫画轮播区 */
        .visual-area {
            position: relative;
            width: 100%;
            height: 55%; /* 占据上半部分 */
            overflow: hidden;
        }
        
        .carousel-track {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.5s ease;
        }
        
        .carousel-item {
            min-width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        /* 漫画风格滤镜 */
        .comic-filter {
            filter: contrast(1.1) saturate(1.2); 
        }
        .comic-filter::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent 60%, #1a1a1a 100%);
        }

        /* 顶部返回与标题 */
        .player-top-bar {
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 20;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .p-back { font-size: 20px; width: 32px; height: 32px; background:rgba(0,0,0,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center; backdrop-filter: blur(4px); }
        .p-book-title { font-weight: bold; font-size: 16px; }

        /* 新：沉浸页底部信息浮层 */
        .player-bottom-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 16px 30px; /* 适配底部安全区 */
            background: linear-gradient(to top, rgba(0,0,0,0.95) 20%, rgba(0,0,0,0.7) 70%, transparent 100%);
            color: #fff;
        }

        .p-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 4px;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        .p-tags::-webkit-scrollbar { display: none; } /* Chrome, Safari */

        .p-tag-item {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
            transition: background 0.2s;
        }
        .p-tag-item:hover { background: rgba(255,255,255,0.3); }

        .p-album-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .p-album-cover {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .p-album-details {
            flex: 1;
            min-width: 0; /* 防止文本过长撑开布局 */
        }

        .p-album-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .p-album-progress {
            font-size: 12px;
            color: #aaa;
        }

        .p-listen-full {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
        }

        /* --- 新：沉浸式播放器 V2 --- */
        .immersive-player .top-nav-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 50px 16px 10px;
            z-index: 110;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4), transparent);
        }
        
        .immersive-player .back-btn {
            font-size: 20px;
            color: #fff;
            cursor: pointer;
        }

        .immersive-player .tab-switcher {
            display: flex;
            background: rgba(255,255,255,0.2);
            border-radius: 18px;
            padding: 2px;
            backdrop-filter: blur(8px);
        }
        
        .immersive-player .switcher-btn {
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .immersive-player .switcher-btn.active {
            background: #fff;
            color: #111;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .immersive-player .content-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            transition: opacity 0.4s ease, visibility 0.4s;
        }

        .immersive-player .content-panel:not(.active) {
            opacity: 0;
            visibility: hidden;
        }
        
        #highlights-panel {
            display: flex;
            flex-direction: column;
            color: #fff;
            padding: 100px 24px 80px; /* 留出顶部和底部空间 */
            text-align: center;
        }

        #highlights-panel .highlight-description {
            font-size: 16px;
            font-weight: bold;
            line-height: 1.6;
            margin-bottom: 24px;
            height: 50px; /* 固定高度防止切换时跳动 */
        }

        #highlights-carousel-container {
            flex: 1;
            overflow: hidden;
            position: relative;
            width: 100%;
        }

        #highlights-carousel-track {
            display: flex;
            height: 100%;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .highlight-review-slide {
            width: 100%;
            height: 100%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .review-card {
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
        }
        
        .review-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .review-card-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .review-card-author .avatar { font-size: 28px; }
        .review-card-author .username { font-size: 14px; font-weight: bold; }
        
        .review-card-likes {
            font-size: 13px;
            color: #ccc;
        }
        .review-card-likes i { margin-left: 6px; }

        .review-card-content {
            font-size: 18px;
            line-height: 1.7;
            margin-bottom: 24px;
            min-height: 80px; /* 固定高度防止跳动 */
        }
        
        .review-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .review-card-footer .replies-link {
            font-size: 12px;
            color: #aaa;
            cursor: pointer;
        }
        
        .carousel-dots {
            display: flex;
            gap: 8px;
        }
        .carousel-dots .dot {
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: background 0.3s;
        }
        .carousel-dots .dot.active {
            background: #fff;
        }
        
        /* 更新：常驻底部信息栏样式 */
        .player-bottom-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 16px 30px; /* 适配安全区 */
            background: linear-gradient(to top, rgba(0,0,0,0.95) 30%, rgba(0,0,0,0.7) 80%, transparent 100%);
            z-index: 115; /* 高于内容面板，低于轮播点 */
            color: #fff;
        }

        .player-bottom-bar .info-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .player-bottom-bar .info-tag {
            font-size: 11px;
            padding: 4px 8px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            white-space: nowrap;
        }

        .player-bottom-bar .main-info {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        .main-info .album-cover {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .main-info .album-details .title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .main-info .album-details .description {
            font-size: 12px;
            color: #ccc;
            line-height: 1.5;
        }

        .player-bottom-bar .progress-cta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .progress-cta .progress-text {
            font-size: 13px;
            color: #aaa;
        }
        
        /* 视频控制按钮 */
        .video-controls button {
            transition: all 0.3s ease;
        }
        .video-controls button:hover {
            background: rgba(0,0,0,0.7) !important;
            transform: scale(1.1);
        }

        /* 3. 底部：控制条与畅听按钮 */
        .control-dock {
            background: #252525;
            padding: 16px 20px 30px; /* 适配底部安全区 */
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        /* 进度条 */
        .prog-row { display: flex; align-items: center; gap: 10px; font-size: 10px; color: #888; margin-bottom: 14px; }
        .prog-bar { flex: 1; height: 3px; background: #444; border-radius: 2px; position: relative; }
        .prog-fill { width: 30%; height: 100%; background: var(--primary); border-radius: 2px; position: relative; }
        .prog-fill::after { content:''; width:8px; height:8px; background:#fff; border-radius:50%; position:absolute; right:-4px; top:-2.5px; box-shadow: 0 0 4px rgba(0,0,0,0.5); }

        /* 控制按钮行 */
        .ctrl-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .play-btns { display: flex; align-items: center; gap: 20px; }
        .btn-icon { font-size: 20px; color: #ddd; }
        .btn-play { font-size: 36px; color: #fff; }

        /* 畅听全集按钮 */
        .jump-album-btn {
            background: linear-gradient(90deg, #ff3b30, #ff9500);
            border: none;
            color: #fff;
            padding: 10px 16px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* 悬浮切换按钮 */
        .switch-mode-btn {
            position: absolute;
            top: 50%;
            right: 10px;
            z-index: 50;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.2);
        }

    </style>
</head>
<body>

<div id="app-shell">
    <!-- 首页 -->
    <div class="home-container">
        <!-- 顶部搜索栏 -->
        <div class="header">
            <div class="search-bar"><i class="fas fa-search" style="margin-right:8px;"></i> 书籍</div>
            <div class="nav-tabs">
                <div class="nav-tab">直播<span class="nav-badge"></span></div>
                <div class="nav-tab active">推荐</div>
                <div class="nav-tab">解忧路</div>
                <div class="nav-tab">小说</div>
                <div class="nav-tab">儿童</div>
                <div class="nav-tab">相声</div>
                <div class="nav-tab">段子</div>
            </div>
        </div>
        
        <!-- 本周收听统计 -->
        <div class="ai-guide">
            <div class="ai-guide-text">本周已收听3分钟 <i class="fas fa-chevron-right" style="font-size:12px; margin-left:4px;"></i></div>
            <div class="vip-promotion">VIP 续费仅需0.32元/天</div>
        </div>
        
        <!-- 横向卡片区域（3:4比例） -->
        <div class="banner-section">
            <div class="horizontal-cards">
                <!-- Card 1: VIP会员卡片 - 粉红色渐变 -->
                <div class="h-card" style="background: linear-gradient(135deg, #d4928b 0%, #c8827b 100%);">
                    <div style="padding:10px; height:100%; display:flex; flex-direction:column; justify-content:space-between;">
                        <div>
                            <div style="background:#b8756f; width:fit-content; padding:3px 6px; border-radius:4px; margin-bottom:6px;">
                                <span style="color:#fff; font-size:8px;">喜马拉雅VIP会员</span>
                            </div>
                            <div style="font-size:10px; font-weight:bold; color:#333; line-height:1.3;">收听领奖 | 最<br>高加赠10天VIP</div>
                        </div>
                        <button class="h-card-btn" style="padding:4px 8px; font-size:9px; background:#fff; color:#d4928b; font-weight:bold;">立即参与</button>
                    </div>
                </div>
                
                <!-- Card 2: 喜马快听 - 蓝绿色渐变 -->
                <div class="h-card" style="background: linear-gradient(135deg, #7ba8a8 0%, #6b9999 100%); position:relative;">
                    <div style="position:absolute; top:6px; right:6px;">
                        <div style="background:#5a8a8a; padding:2px 6px; border-radius:4px;">
                            <span style="color:#fff; font-size:8px;">种草</span>
                        </div>
                    </div>
                    <div style="padding:10px; height:100%; display:flex; flex-direction:column; justify-content:flex-end;">
                        <div style="font-size:10px; font-weight:bold; color:#fff; margin-bottom:4px; line-height:1.3;">喜马快听 | 绍<br>宋起点穿越...</div>
                        <div style="display:flex; align-items:center; gap:4px;">
                            <i class="fas fa-play-circle" style="font-size:10px; color:#fff;"></i>
                            <button class="h-card-btn" style="padding:3px 8px; font-size:9px; background:rgba(255,255,255,0.9); color:#7ba8a8;">剩1分钟</button>
                        </div>
                    </div>
                </div>
                
                <!-- Card 3: 订阅 - 深蓝灰色渐变 -->
                <div class="h-card" style="background: linear-gradient(135deg, #5a6b7a 0%, #4a5a6a 100%); position:relative;">
                    <div style="position:absolute; top:6px; right:6px;">
                        <div style="background:rgba(255,255,255,0.9); padding:2px 6px; border-radius:4px;">
                            <span style="color:#333; font-size:8px;">订阅</span>
                        </div>
                    </div>
                    <div style="padding:10px; height:100%; display:flex; flex-direction:column; justify-content:flex-end;">
                        <div style="font-size:10px; font-weight:bold; color:#fff; margin-bottom:4px; line-height:1.3;">订阅 | Vol.169<br>在版纳和普...</div>
                        <div style="display:flex; align-items:center; gap:4px;">
                            <i class="fas fa-play-circle" style="font-size:10px; color:#fff;"></i>
                            <button class="h-card-btn" style="padding:3px 8px; font-size:9px; background:rgba(255,255,255,0.9); color:#5a6b7a;">立即收听</button>
                        </div>
                    </div>
                </div>
                
                <!-- Card 4: 你稀 - 黄色渐变 -->
                <div class="h-card" style="background: linear-gradient(135deg, #d4c48a 0%, #c8b87a 100%); position:relative;">
                    <div style="position:absolute; top:8px; right:8px; font-size:14px;">✨</div>
                    <div style="padding:10px; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <div style="font-size:16px; font-weight:bold; color:#333; text-align:center; margin-bottom:8px;">你稀</div>
                        <div style="font-size:8px; color:#666; text-align:center;">稀奇古怪</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 你的专属推荐 -->
        <div class="recommend-section">
            <div class="section-title">
                你的专属推荐
                <span class="section-more"><i class="fas fa-ellipsis-h"></i></span>
            </div>
            
            <!-- 列表卡片区域 -->
            <div id="list-cards">
                <!-- JS生成 -->
            </div>
            
            <!-- 双列卡片区域 -->
            <div class="feed-grid" id="feed-grid">
                <!-- JS生成卡片 -->
            </div>
            
        </div>
    </div>

    <!-- 底部导航 -->
    <div style="position:absolute; bottom:0; width:100%; height:50px; background:#fff; display:flex; justify-content:space-around; align-items:center; border-top:1px solid #eee; z-index:10;">
        <div style="color:var(--primary); display:flex; flex-direction:column; align-items:center; gap:4px;">
            <i class="fas fa-home" style="font-size:22px;"></i>
            <span style="font-size:10px;">首页</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; color:#999;">
            <i class="fas fa-headphones" style="font-size:22px;"></i>
            <span style="font-size:10px;">快听</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; color:#999; position:relative;">
            <i class="fas fa-play-circle" style="font-size:32px;"></i>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; color:#999;">
            <i class="fas fa-crown" style="font-size:22px;"></i>
            <span style="font-size:10px;">会员</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; color:#999;">
            <i class="fas fa-user" style="font-size:22px;"></i>
            <span style="font-size:10px;">我的</span>
        </div>
    </div>

    <!-- 沉浸式播放器层 -->
    <div class="immersive-player" id="player">
        
        <!-- 新：顶部导航栏 -->
        <div class="top-nav-bar">
            <span class="back-btn" onclick="closePlayer()"><i class="fas fa-chevron-down"></i></span>
            <div class="tab-switcher">
                <div id="tab-video" class="switcher-btn active" onclick="switchImmersiveTab('video')">视频</div>
                <div id="tab-highlights" class="switcher-btn" onclick="switchImmersiveTab('highlights')">亮点</div>
            </div>
            <span style="width: 20px;"></span> <!-- 占位符，为了让tab居中 -->
        </div>

        <!-- 内容面板 -->
        <div id="video-panel" class="content-panel active">
            <video id="immersive-video" style="width: 100%; height: 100%; object-fit: cover;" autoplay muted loop>
                <source src="" type="video/mp4">
            </video>
        </div>

        <div id="highlights-panel" class="content-panel">
            <div id="highlight-top-description" class="highlight-description">
                <!-- JS Populated -->
            </div>
            <div id="highlights-carousel-container">
                <div id="highlights-carousel-track">
                    <!-- JS Populated -->
                </div>
            </div>
        </div>

        <!-- 更新：常驻底部信息栏 -->
        <div class="player-bottom-bar">
            <div id="player-bar-tags" class="info-tags">
                <!-- JS Populated -->
            </div>
            <div class="main-info">
                <img id="player-bar-cover" class="album-cover" src="">
                <div class="album-details">
                    <div id="player-bar-title" class="title"></div>
                    <div id="player-bar-desc" class="description"></div>
                </div>
            </div>
            <div class="progress-cta">
                <div id="player-bar-progress" class="progress-text"></div>
                <button class="p-listen-full" onclick="goToAlbum()">畅听全集</button>
            </div>
        </div>
    </div>

    <!-- 旧的亮点详情页 (不再使用) -->
    <div id="highlights-view" style="display: none;"></div>

</div>

<script>
    // --- 动态路径解决方案 ---
    const isGithubPages = window.location.hostname.includes('github.io');
    const basePath = isGithubPages ? '/wangwen/' : '';

    // 书籍数据，从CSV汇总物料中提取的13个卡片
    const books = [
        {
            id: 1,
            persona: 'male-youth',
            title: "【高玩心态+机制破解】末日废土我靠扮演法旧日成神",
            author: "爱潜水的乌贼",
            tags: ["19.03亿人听过","克苏鲁"],
            description: "末日废土我靠扮演法旧日成神",
            cover: "图片/诡秘之主-男青年-封面图.png",
            plays: "19.03亿",
            badge: "热播",
            ranking: "月票榜NO.3",
            videoFile: "video-male-youth.mp4",
            albumTitle: "诡秘之主",
            episodes: 1488,
            themeColor: "#5a4d7c",
            highlights: []
        },
        {
            id: 2,
            persona: 'male-youth',
            title: "【高玩心态+机制破解】蒸汽与机械的浪潮中，谁能触及非凡？",
            author: "爱潜水的乌贼",
            tags: ["19.03亿人听过"],
            description: "末日废土我靠扮演法旧日成神",
            cover: "图片/诡秘之主-男青年-精彩片段图.png",
            plays: "19.03亿",
            badge: "热播",
            ranking: "月票榜NO.3",
            videoFile: "video-male-youth.mp4",
            albumTitle: "诡秘之主",
            episodes: 1488,
            themeColor: "#5a4d7c",
            highlights: []
        },
        {
            id: 3,
            persona: 'male-youth',
            title: "【高玩心态+机制破解+克苏鲁+烧脑】",
            author: "爱潜水的乌贼",
            tags: [],
            description: "末日废土我靠扮演法旧日成神",
            cover: "图片/诡秘之主-剧情梗概图.png",
            plays: "19.03亿",
            badge: "热播",
            ranking: "月票榜NO.3",
            videoFile: "video-male-youth.mp4",
            albumTitle: "诡秘之主",
            episodes: 1488,
            themeColor: "#5a4d7c",
            highlights: []
        },
        {
            id: 4,
            persona: 'female-youth',
            title: "【美强惨+破碎感】他于迷雾中独行：在深渊凝视长夜",
            author: "爱潜水的乌贼",
            tags: [],
            description: "他于迷雾中独行：在深渊凝视长夜",
            cover: "图片/诡秘之主-女青年-封面图.png",
            plays: "19.03亿",
            badge: "热播",
            ranking: "月票榜NO.3",
            videoFile: "video-female-youth.mp4",
            albumTitle: "诡秘之主",
            episodes: 1488,
            themeColor: "#cfa98b",
            highlights: []
        },
        {
            id: 5,
            persona: 'female-youth',
            title: "蒸汽与机械的浪潮中，谁能触及非凡？历史和黑暗的迷雾",
            author: "爱潜水的乌贼",
            tags: ["19.03亿人听过","烧脑"],
            description: "他于迷雾中独行：在深渊凝视长夜",
            cover: "图片/诡秘之主-女青年-精彩片段图.png",
            plays: "19.03亿",
            badge: "热播",
            ranking: "月票榜NO.3",
            videoFile: "video-female-youth.mp4",
            albumTitle: "诡秘之主",
            episodes: 1488,
            themeColor: "#cfa98b",
            highlights: []
        },
        {
            id: 6,
            persona: 'male-elderly',
            title: "【都市神医+重振家族】三年隐忍，他是被人戳脊梁骨的废物赘婿，洗衣做饭，卑微入尘。",
            author: "叶公子",
            tags: ["45.3亿人听过", "畅销榜NO.1"],
            description: "给老婆端了三年洗脚水，庆寿当天叶家真龙归位",
            cover: "图片/上门龙婿-男老年-封面图.png",
            plays: "45.3亿",
            badge: "热播",
            ranking: "畅销榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "上门龙婿",
            episodes: 1200,
            themeColor: "#3d3d3d",
            highlights: []
        },
        {
            id: 7,
            persona: 'male-middle',
            title: "【扮猪吃虎+多红颜+职场+…",
            author: "叶公子",
            tags: ["45.3亿人听过", "畅销榜NO.1"],
            description: "美艳老婆嫌我穷，豪门世家找上门后跪求复婚",
            cover: "图片/上门龙婿-男中年-封面图.png",
            plays: "45.3亿",
            badge: "热播",
            ranking: "畅销榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "上门龙婿",
            episodes: 1200,
            themeColor: "#4a4a4a",
            highlights: []
        },
        {
            id: 8,
            persona: 'male-middle',
            title: "三年隐忍，他是被人戳脊梁…",
            author: "叶公子",
            tags: ["45.3亿人听过","扮猪吃虎"],
            description: "美艳老婆嫌我穷，豪门世家找上门后跪求复婚",
            cover: "图片/上门龙婿-精彩片段图.png",
            plays: "45.3亿",
            badge: "热播",
            ranking: "畅销榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "上门龙婿",
            episodes: 1200,
            themeColor: "#4a4a4a",
            highlights: []
        },
        {
            id: 9,
            persona: 'male-middle',
            title: "【扮猪吃虎+多红颜+赘婿】美艳老婆嫌我穷，豪门世家找上门后跪求复婚",
            author: "叶公子",
            tags: ["45.3亿人听过", "畅销榜NO.1"],
            description: "美艳老婆嫌我穷，豪门世家找上门后跪求复婚",
            cover: "图片/上门龙婿-剧情梗概图.png",
            plays: "45.3亿",
            badge: "热播",
            ranking: "畅销榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "上门龙婿",
            episodes: 1200,
            themeColor: "#4a4a4a",
            highlights: []
        },
        {
            id: 10,
            persona: 'female-elderly',
            title: "【恶婆婆现世报+极致甜宠】重生后踹了极品渣爹，带苦命妈走上人生巅峰",
            author: "宝妆成",
            tags: ["85.6亿人听过", "女生榜NO.1"],
            description: "重生后踹了极品渣爹，带苦命妈走上人生巅峰",
            cover: "图片/重生八零-女老年-封面图.png",
            plays: "85.6亿",
            badge: "爆款",
            ranking: "女生榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "重生八零媳妇有点辣",
            episodes: 800,
            themeColor: "#8c7a6b",
            highlights: []
        },
        {
            id: 11,
            persona: 'female-middle',
            title: "重回八零年，她成了名声尽毁的“坏女人”，还面临被极品亲戚卖掉抵债的地狱开局？",
            author: "宝妆成",
            tags: ["85.6亿人听过"],
            description: "从摆地摊到地产女王：我把烂牌打成王炸",
            cover: "图片/重生八零-女中年-封面图.png",
            plays: "85.6亿",
            badge: "爆款",
            ranking: "女生榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "重生八零媳妇有点辣",
            episodes: 800,
            themeColor: "#4b4269",
            highlights: []
        },
        {
            id: 12,
            persona: 'female-middle',
            title: "【弃妇的第二春+重生年代搞钱】从摆地摊到地产女王：我把烂牌打成王炸",
            author: "宝妆成",
            tags: ["完结"],
            description: "从摆地摊到地产女王：我把烂牌打成王炸",
            cover: "图片/重生八零-精彩片段图.png",
            plays: "85.6亿",
            badge: "爆款",
            ranking: "女生榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "重生八零媳妇有点辣",
            episodes: 800,
            themeColor: "#4b4269",
            highlights: []
        },
        {
            id: 13,
            persona: 'female-middle',
            title: "【弃妇的第二春+重生年代搞钱】从摆地摊到地产女王：我把烂牌打成王炸",
            author: "宝妆成",
            tags: ["女生榜NO.1"],
            description: "从摆地摊到地产女王：我把烂牌打成王炸",
            cover: "图片/重生八零-剧情梗概图.png",
            plays: "85.6亿",
            badge: "爆款",
            ranking: "女生榜NO.1",
            videoFile: "video-male-youth.mp4",
            albumTitle: "重生八零媳妇有点辣",
            episodes: 800,
            themeColor: "#4b4269",
            highlights: []
        }
    ];

    // 列表卡片数据 (保持不变)
    const listCards = [
        { title: "长谈·脱不花", desc: "与人长谈，和别人上个请教，就是最好的学习", reco: "100%", plays: "9.3万", cover: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=200&q=80" },
        { title: "今日圆桌派", desc: "多角度解读，拓展认知边界", reco: "87%", plays: "472万", cover: "https://images.unsplash.com/photo-1557426272-fc759fdf7a8d?auto=format&fit=crop&w=200&q=80", badge: "NEW POINTS" },
        { title: "董慧琦：正念冥想课", desc: "期坦福正念冥想，助你一夜好眠", reco: "", plays: "440万", cover: "https://images.unsplash.com/photo-1506126613408-eca07ce68773?auto=format&fit=crop&w=200&q=80", badge: "SVIP" }
    ];

    let currentBook = null;
    let autoMode = true;
    let highlightCarouselInterval = null;
    let currentHighlightIndex = 0;
 
     document.addEventListener('DOMContentLoaded', function() {
         // 初始化列表卡片
         const listCardsContainer = document.getElementById('list-cards');
         if (listCardsContainer) {
             // 清空，防止重复渲染
             listCardsContainer.innerHTML = '';
             listCards.forEach(item => {
                 const card = document.createElement('div');
                 card.className = 'list-card';
                 card.innerHTML = `
                     <div class="list-card-cover" style="background-image: url('${item.cover}')">
                         ${item.badge ? `<div style="position:absolute; top:4px; left:4px; background:#ffd700; color:#333; font-size:8px; padding:2px 4px; border-radius:3px; font-weight:bold;">${item.badge}</div>` : ''}
                     </div>
                     <div class="list-card-info">
                         <div class="list-card-title">${item.title}</div>
                         <div class="list-card-desc">${item.desc}</div>
                         <div style="display:flex; gap:8px; align-items:center; margin-top:4px;">
                             ${item.reco ? `<span style="font-size:11px; color:#666;">推荐值${item.reco}</span>` : ''}
                             <span style="font-size:11px; color:#999;"><i class="fas fa-play-circle" style="margin-right:3px;"></i>${item.plays}</span>
                         </div>
                     </div>
                 `;
                 listCardsContainer.appendChild(card);
             });
         }
 
         const feedGrid = document.getElementById('feed-grid');
          
          if (feedGrid) {
              // 清空现有grid
              feedGrid.innerHTML = '';
              books.forEach(book => {
                  try {
                      const card = createGridCard(book);
                      feedGrid.appendChild(card);
                  } catch (error) {
                      console.error('Error creating card for book:', book, error);
                  }
              });
          }
     });
     
    function createGridCard(book) {
        const card = document.createElement('div');
        card.className = 'grid-card';
        
        // 确保 tags 存在且是数组
        const tags = Array.isArray(book.tags) ? book.tags : [];

        // 判断是否为最后三张卡片（id >= 11）
        const isInlineLayout = book.id >= 11;

        if (isInlineLayout) {
            // 最后三张卡片：标签和标题在一行
            card.innerHTML = `
                <div class="grid-card-cover" style="background-image: url('${basePath + book.cover}')">
                   <!-- 角标被CSS隐藏 -->
                </div>
                <div class="grid-card-info">
                    <div class="grid-card-title">${book.albumTitle}</div>
                    <div class="grid-card-inline-layout">
                       ${tags.map(tag => `<span class="grid-tag">${tag}</span>`).join('')}
                       <span class="inline-title">${book.title}</span>
                    </div>
                </div>
            `;
        } else {
            // 前10张卡片：原有布局
            card.innerHTML = `
                <div class="grid-card-cover" style="background-image: url('${basePath + book.cover}')">
                   <!-- 角标被CSS隐藏 -->
                </div>
                <div class="grid-card-info">
                    <div>
                       <div class="grid-card-title">${book.albumTitle}</div>
                       <div class="grid-card-description">${book.title}</div>
                    </div>
                    <div class="grid-card-tags">
                       ${tags.map(tag => `<span class="grid-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
        }
        
        card.onclick = () => openPlayer(book);
        return card;
    }

     // 打开播放器
     function openPlayer(book) {
         currentBook = book;
         const player = document.getElementById('player');
         
         // 1. 设置视频
         const video = document.getElementById('immersive-video');
         if (book.videoFile) {
             video.src = basePath + book.videoFile;
             video.play().catch(e => console.error("视频播放失败:", e));
         }

         // 2. 设置常驻底部信息栏
         document.getElementById('player-bar-title').innerText = book.albumTitle || book.title;
         document.getElementById('player-bar-cover').src = basePath + book.cover;
         document.getElementById('player-bar-desc').innerText = book.description || '';
         document.getElementById('player-bar-progress').innerText = `已完结 · 共${book.episodes || 0}集`;
         
         const tagsContainer = document.getElementById('player-bar-tags');
         tagsContainer.innerHTML = '';
         const infoTags = [book.ranking, book.badge, book.plays].filter(Boolean);
         infoTags.forEach(tag => {
            const tagEl = document.createElement('div');
            tagEl.className = 'info-tag';
            tagEl.innerText = tag;
            tagsContainer.appendChild(tagEl);
         });


         // 3. 重置到视频tab并打开播放器
         switchImmersiveTab('video'); // 确保从视频页开始
         player.classList.add('active');
     }

     // 关闭播放器
     function closePlayer() {
         document.getElementById('player').classList.remove('active');
         const video = document.getElementById('immersive-video');
         video.pause();
     }
     
     // 切换沉浸页的Tab
     function switchImmersiveTab(tabName) {
        const videoPanel = document.getElementById('video-panel');
        const highlightsPanel = document.getElementById('highlights-panel');
        const tabVideo = document.getElementById('tab-video');
        const tabHighlights = document.getElementById('tab-highlights');
        const video = document.getElementById('immersive-video');
        const bottomBar = document.querySelector('.player-bottom-bar');

        bottomBar.style.display = 'block'; // 确保底部栏一直显示

        if (tabName === 'video') {
            videoPanel.classList.add('active');
            highlightsPanel.classList.remove('active');
            tabVideo.classList.add('active');
            tabHighlights.classList.remove('active');
            video.play().catch(e => {}); // 切换回来时尝试播放
            stopHighlightCarousel();
        } else {
            // --- 动态填充新的亮点轮播内容 ---
            const highlightsPanel = document.getElementById('highlights-panel');
            const descriptionContainer = document.getElementById('highlight-top-description');
            const highlightsTrack = document.getElementById('highlights-carousel-track');
            
            highlightsPanel.style.backgroundColor = currentBook.themeColor || '#181818';
            highlightsTrack.innerHTML = ''; // 清空旧内容

            if (currentBook.highlights && currentBook.highlights.length > 0) {
                currentBook.highlights.forEach(highlight => {
                    const firstReview = highlight.reviews[0];
                    const slide = document.createElement('div');
                    slide.className = 'highlight-review-slide';
                    slide.innerHTML = `
                        <div class="review-card">
                            <div class="review-card-header">
                                <div class="review-card-author">
                                    <div class="avatar">${firstReview.avatar}</div>
                                    <div class="username">${firstReview.user}</div>
                                </div>
                                <div class="review-card-likes">
                                    <span>${firstReview.likes}</span><i class="fas fa-thumbs-up"></i>
                                </div>
                            </div>
                            <div class="review-card-content">“${firstReview.content}”</div>
                            <div class="review-card-footer">
                                <span class="replies-link">查看 ${Math.floor(Math.random() * 20) + 5} 条回复 <i class="fas fa-chevron-right" style="font-size: 10px;"></i></span>
                                <div class="carousel-dots">
                                    ${currentBook.highlights.map((_, i) => `<div class="dot" data-index="${i}"></div>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    highlightsTrack.appendChild(slide);
                });
            }
            // --- 填充结束 ---

            videoPanel.classList.remove('active');
            highlightsPanel.classList.add('active');
            tabVideo.classList.remove('active');
            tabHighlights.classList.add('active');
            video.pause(); // 切换走时暂停视频
            startHighlightCarousel();
        }
     }

     // --- 新的亮点轮播逻辑 ---
     function startHighlightCarousel() {
        if (highlightCarouselInterval) clearInterval(highlightCarouselInterval);
        currentHighlightIndex = -1; // Start before the first slide
        
        const updateSlide = () => {
            const totalSlides = currentBook?.highlights?.length || 0;
            if (totalSlides > 0) {
                currentHighlightIndex = (currentHighlightIndex + 1) % totalSlides;
                showHighlightSlide(currentHighlightIndex);
            }
        };

        updateSlide(); // Show first slide immediately
        if ((currentBook?.highlights?.length || 0) > 1) {
            highlightCarouselInterval = setInterval(updateSlide, 5000); // Switch every 5 seconds
        }
     }

     function stopHighlightCarousel() {
        if (highlightCarouselInterval) {
            clearInterval(highlightCarouselInterval);
            highlightCarouselInterval = null;
        }
     }

     function showHighlightSlide(index) {
        const track = document.getElementById('highlights-carousel-track');
        const descriptionContainer = document.getElementById('highlight-top-description');
        const allDots = document.querySelectorAll('.carousel-dots .dot');

        if (!currentBook || !currentBook.highlights[index]) return;

        // 更新顶部描述
        descriptionContainer.innerText = currentBook.highlights[index].description;
        
        // 移动轨道
        track.style.transform = `translateX(-${index * 100}%)`;

        // 更新所有卡片中的分页符状态
        allDots.forEach(dot => {
            dot.classList.toggle('active', parseInt(dot.dataset.index) === index);
        });
     }
     
     // 显示合集列表 (保留弹窗逻辑)
     function showEpisodeList() {
         if (!currentBook || !currentBook.episodes) {
             alert('暂无合集信息');
             return;
         }
         const episodeListText = currentBook.episodes.join('\n');
         alert('合集列表：\n' + episodeListText);
     }
 
     // 轮播逻辑 (不再需要，但保留函数以防其他地方调用)
     function setupCarousel(images) {
        const track = document.getElementById('carousel-track');
        track.innerHTML = '';
        images.forEach(img => {
            const div = document.createElement('div');
            div.className = 'carousel-item comic-filter';
            div.style.backgroundImage = `url('${img}')`;
            track.appendChild(div);
        });

        let index = 0;
        clearInterval(carouselInterval);
        
        // 自动轮播
        carouselInterval = setInterval(() => {
            if(!autoMode) return;
            index = (index + 1) % images.length;
            track.style.transform = `translateX(-${index * 100}%)`;
        }, 3000); // 3秒切换一张
    }

    // 切换交互模式
    function toggleAutoMode() {
        autoMode = !autoMode;
        const txt = document.getElementById('mode-text');
        txt.innerText = autoMode ? "自动演示中" : "手动浏览";
        txt.parentElement.style.background = autoMode ? "rgba(0,0,0,0.6)" : "var(--primary)";
    }

    // Tab 切换逻辑
    // function switchImmersiveTab(type) { ... }

    // 跳转逻辑
    function goToAlbum() {
        // 简单的交互反馈
        const btn = document.querySelector('.p-listen-full');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 跳转中...';
        setTimeout(() => {
            alert(`正在前往《${currentBook.title}》专辑全集页面...`);
            btn.innerHTML = '畅听全集 <i class="fas fa-angle-right"></i>';
        }, 800);
    }

    // 初始化时默认选中第一个Tab
    // (在真实环境中需要在 openPlayer 时调用一次 ensure active state)

</script>
</body>
</html>